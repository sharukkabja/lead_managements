{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Lead-management-system/frontend/app/services/api.ts"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst api = axios.create({\r\n  baseURL: process.env.NEXT_PUBLIC_API_BASE_URL,\r\n  timeout: 10000,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    if (typeof window !== 'undefined') {\r\n      const status = error.response?.status;\r\n\r\n      if (status === 401) {\r\n        console.warn('Unauthorized - redirecting to login');\r\n        localStorage.removeItem('token');\r\n        window.location.href = '/login';\r\n      }\r\n\r\n      if (status === 500) {\r\n        console.error('Server error');\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n"],"names":[],"mappings":";;;;AAGW;AAHX;;AAEA,MAAM,MAAM,mJAAK,CAAC,MAAM,CAAC;IACvB,OAAO;IACP,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEA,IAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC3B,CAAC,WAAa,UACd,CAAC;IACC,wCAAmC;QACjC,MAAM,SAAS,MAAM,QAAQ,EAAE;QAE/B,IAAI,WAAW,KAAK;YAClB,QAAQ,IAAI,CAAC;YACb,aAAa,UAAU,CAAC;YACxB,OAAO,QAAQ,CAAC,IAAI,GAAG;QACzB;QAEA,IAAI,WAAW,KAAK;YAClB,QAAQ,KAAK,CAAC;QAChB;IACF;IAEA,OAAO,QAAQ,MAAM,CAAC;AACxB;uCAGa"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/Lead-management-system/frontend/app/services/leadService.tsx"],"sourcesContent":["import api from './api';\r\n\r\nconst leadService = {\r\n  getLeads: (params?: Record<string, any>) =>\r\n    api.get('/leads', { params }),\r\n\r\n  getLeadById: (id: number) =>\r\n    api.get(`/leads/${id}/timeline`),\r\n\r\n  createLead: (data: any) =>\r\n    api.post('/leads', data),\r\n\r\n  updateStatus: (id: number, status: string) =>\r\n    api.put(`/leads/${id}/status`, { status }),\r\n  \r\n  CheckDuplicateLead: (data: any) =>\r\n    api.post('/leads/check-duplicate', data),\r\n};\r\n\r\nexport default leadService;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc;IAClB,UAAU,CAAC,SACT,oIAAG,CAAC,GAAG,CAAC,UAAU;YAAE;QAAO;IAE7B,aAAa,CAAC,KACZ,oIAAG,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,GAAG,SAAS,CAAC;IAEjC,YAAY,CAAC,OACX,oIAAG,CAAC,IAAI,CAAC,UAAU;IAErB,cAAc,CAAC,IAAY,SACzB,oIAAG,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,GAAG,OAAO,CAAC,EAAE;YAAE;QAAO;IAE1C,oBAAoB,CAAC,OACnB,oIAAG,CAAC,IAAI,CAAC,0BAA0B;AACvC;uCAEe"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///D:/Lead-management-system/frontend/app/leads/%5B...id%5D/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState, useMemo } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Paper,\r\n  Stack,\r\n  Chip,\r\n  Select,\r\n  MenuItem,\r\n  FormControl,\r\n  InputLabel,\r\n  Alert,\r\n} from '@mui/material';\r\nimport leadService from '../../services/leadService';\r\n\r\n/* ================= TYPES ================= */\r\n\r\ninterface AssignedUser {\r\n  id: number;\r\n  name: string;\r\n}\r\n\r\ninterface Activity {\r\n  id: number;\r\n  date: string;\r\n  type: string;\r\n  message: string;\r\n  createdAt: string;\r\n  activities:[];\r\n}\r\n\r\ninterface Lead {\r\n  id: number;\r\n  name: string;\r\n  email: string;\r\n  phone?: string;\r\n  status: string;\r\n  source?: string;\r\n  assignedUser?: AssignedUser | null;\r\n  updatedAt: string;\r\n  activities: Activity[];\r\n}\r\n\r\n/* Allowed status transitions */\r\nconst STATUS_TRANSITIONS: Record<string, string[]> = {\r\n  new: ['contacted', 'lost'],\r\n  contacted: ['qualified', 'lost'],\r\n  qualified: ['converted', 'lost'],\r\n  converted: [],\r\n  lost: [],\r\n};\r\n\r\n/* ================= COMPONENT ================= */\r\n\r\nexport default function LeadDetailPage() {\r\n  const { id } = useParams();\r\n  const [lead, setLead] = useState<Lead | null>(null);\r\n  const [activities, setActivities] = useState<Activity[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(false);\r\n  const [statusError, setStatusError] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    fetchLead();\r\n  }, [id]);\r\n\r\n  const fetchLead = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await leadService.getLeadById(id);\r\n      console.log('Lead data:', res.data.data);\r\n      setLead(res.data.data.lead);\r\n      setActivities(res.data.data.activities);\r\n    } catch (error) {\r\n      console.error('Failed to fetch lead', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (newStatus: string) => {\r\n  if (!lead) return;\r\n\r\n  const allowed = STATUS_TRANSITIONS[lead.status] || [];\r\n  if (!allowed.includes(newStatus)) {\r\n    setStatusError(\r\n      `Invalid status transition from \"${lead.status}\" to \"${newStatus}\"`\r\n    );\r\n    return;\r\n  }\r\n\r\n  setStatusError('');\r\n\r\n  const now = new Date();\r\n  const dateStr = now.toISOString().split('T')[0];\r\n\r\n  const newActivity = {\r\n    id: Date.now(),\r\n    type: 'status_change',\r\n    message: `Status changed to ${newStatus}`,\r\n    createdAt: now.toISOString(),\r\n    createdBy: null,\r\n  };\r\n\r\n  // 1️⃣ Optimistically update lead info ONLY\r\n  setLead({\r\n    ...lead,\r\n    status: newStatus,\r\n    updatedAt: now.toISOString(),\r\n  });\r\n\r\n  // 2️⃣ Optimistically update timeline (REAL-TIME)\r\n  setActivities((prev) => {\r\n    const index = prev.findIndex((g) => g.date === dateStr);\r\n\r\n    if (index !== -1) {\r\n      const updated = [...prev];\r\n      updated[index] = {\r\n        ...updated[index],\r\n        activities: [newActivity, ...updated[index].activities],\r\n      };\r\n      return updated;\r\n    }\r\n\r\n    return [{ date: dateStr, activities: [newActivity] }, ...prev];\r\n  });\r\n\r\n  try {\r\n    await leadService.updateStatus(lead.id, newStatus);\r\n  } catch (error) {\r\n    console.error('Failed to update status', error);\r\n    // optional rollback here\r\n  }\r\n};\r\n\r\n\r\n  // Group activities by date\r\nconst activitiesByDate = useMemo(() => {\r\n  if (!lead) return {};\r\n  \r\n  // Ensure activities is always an array\r\n  const activities = lead.activities || [];\r\n\r\n  return activities.reduce<Record<string, Activity[]>>((acc, activity) => {\r\n    const date = new Date(activity.createdAt).toLocaleDateString();\r\n    if (!acc[date]) acc[date] = [];\r\n    acc[date].push(activity);\r\n    return acc;\r\n  }, {});\r\n}, [lead]);\r\n\r\n\r\n  if (loading || !lead) return <Typography>Loading...</Typography>;\r\n\r\n  return (\r\n    <Box p={3}>\r\n      <Typography variant=\"h5\" fontWeight={600} mb={2}>\r\n        Lead Detail\r\n      </Typography>\r\n\r\n      {/* Lead Info */}\r\n      <Paper sx={{ p: 2, mb: 3 }}>\r\n        <Stack spacing={1}>\r\n          <Typography><strong>Name:</strong> {lead.name}</Typography>\r\n          <Typography><strong>Email:</strong> {lead.email}</Typography>\r\n          {lead.phone && <Typography><strong>Phone:</strong> {lead.phone}</Typography>}\r\n          <Typography><strong>Source:</strong> {lead.source || '-'}</Typography>\r\n          <Typography>\r\n            <strong>Assigned User:</strong> {lead.assignedUser?.name || '-'}\r\n          </Typography>\r\n          <Typography>\r\n            <strong>Status:</strong>{' '}\r\n            <Chip\r\n              label={lead.status}\r\n              color={\r\n                lead.status === 'converted'\r\n                  ? 'success'\r\n                  : lead.status === 'lost'\r\n                  ? 'error'\r\n                  : 'default'\r\n              }\r\n              size=\"small\"\r\n            />\r\n          </Typography>\r\n        </Stack>\r\n      </Paper>\r\n\r\n      {/* Change Status */}\r\n      <FormControl size=\"small\" sx={{ mb: 2, minWidth: 200 }}>\r\n        <InputLabel>Change Status</InputLabel>\r\n        <Select\r\n          value={lead.status}\r\n          label=\"Change Status\"\r\n          onChange={(e) => handleStatusChange(e.target.value)}\r\n        >\r\n          {Object.keys(STATUS_TRANSITIONS).map((status) => (\r\n            <MenuItem key={status} value={status}>\r\n              {status.charAt(0).toUpperCase() + status.slice(1)}\r\n            </MenuItem>\r\n          ))}\r\n        </Select>\r\n      </FormControl>\r\n\r\n      {statusError && <Alert severity=\"error\" sx={{ mb: 2 }}>{statusError}</Alert>}\r\n\r\n    {/* Activity Timeline */}\r\n<Typography variant=\"h6\" mb={1}>\r\n  Activity Timeline\r\n</Typography>\r\n\r\n{activities\r\n  // Sort descending by date\r\n  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n  .map((group) => (\r\n    <Box key={group.date} sx={{ mb: 2 }}>\r\n      <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n        {group.date}\r\n      </Typography>\r\n      <Stack spacing={1} sx={{ ml: 2 }}>\r\n        {group.activities.map((activity) => (\r\n          <Paper key={activity.id} sx={{ p: 1 }}>\r\n            <Typography variant=\"body2\">\r\n              <strong>{activity.type ? activity.type.replace('_', ' ') : 'Activity'}:</strong>{' '}\r\n              {activity.message || '-'}\r\n            </Typography>\r\n            <Typography variant=\"caption\" color=\"text.secondary\">\r\n              {new Date(activity.createdAt).toLocaleTimeString()}\r\n              {activity.createdBy ? ` | By: ${activity.createdBy.name}` : ''}\r\n            </Typography>\r\n          </Paper>\r\n        ))}\r\n      </Stack>\r\n    </Box>\r\n  ))}\r\n\r\n    </Box>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}